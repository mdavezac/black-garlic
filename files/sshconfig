{% set keytype = "ed25519" if grains['os'] == "MacOS" else "rsa" %}
IdentitiesOnly=yes
{% if grains['os'] == "MacOS" -%}
UseKeychain yes
{% endif -%}
AddKeysToAgent yes
Host gitlab gitlab.com
  User git
  HostName gitlab.com
  IdentityFile ~/.ssh/gitlab_{{keytype}}
  PreferredAuthentications publickey
Host github github.com
  User git
  HostName github.com
  IdentityFile ~/.ssh/github_{{keytype}}
  PreferredAuthentications publickey
Host gist gist.github.com
  User git
  HostName gist.github.com
  IdentityFile ~/.ssh/github_{{keytype}}
  PreferredAuthentications publickey
Host bitbucket bitbucket.org
  hostname bitbucket.org
  User git
  PreferredAuthentications publickey
  ForwardAgent no
  IdentityFile ~/.ssh/bitbucket_rsa
{% for (name, hostname) in legion.items() %}
Host {{name}} {{hostname}}
  hostname {{hostname}}
  User cceamda
  ForwardAgent yes
  IdentityFile ~/.ssh/legion_ed25519
  PreferredAuthentications publickey
{% endfor %}
